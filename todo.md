# 実装タスクリスト

## 📋 プロジェクトセットアップ

- [ ] 必要な依存関係のインストール

  - [ ] `sharp`（画像処理・Raw データ取得・エンコード用）
  - [ ] 型定義（必要に応じて）
  - 注: `next/og`（Next.js 組み込み）で Satori と@resvg/resvg-js は不要

- [ ] プロジェクト構成の確認
  - [ ] Next.js App Router 構成の確認
  - [ ] TypeScript 設定の確認

## 🎨 色パレット・設定

- [ ] 色パレット設定ファイルの作成
  - [ ] `src/config/palette.ts` または `src/config/palette.json` を作成
  - [ ] 7 色パレットの定義（black, white, green, blue, red, yellow, orange）
  - [ ] TypeScript 型定義の作成

## 🔤 フォント設定

- [ ] フォントの準備
  - [ ] Noto Sans JP フォントファイルの取得方法の調査
  - [ ] Inter / Roboto フォントの取得
  - [ ] `next/og` 用フォント読み込み関数の実装
  - [ ] `src/utils/fonts.ts` の作成

## 🖼️ 画像生成処理の実装

- [ ] 基本レンダリング機能

  - [ ] `next/og` の `ImageResponse` を使った JSX → PNG 変換の実装
  - [ ] 解像度 800x480px の設定
  - [ ] 初期テスト用のシンプルな JSX テンプレート作成
  - [ ] 注: `next/og` が内部的に Satori と @resvg/resvg-js を使用

- [ ] Raw データ取得

  - [ ] sharp を使用した PNG → RGBA 配列の変換
  - [ ] 画素データの取得・操作関数の実装

- [ ] 減色処理アルゴリズム

  - [ ] 7 色パレットへの近似関数（最近傍色の選択）
  - [ ] フロイド-スタインバーグ・ディザリングの実装
  - [ ] 誤差拡散処理の実装
  - [ ] `src/utils/dithering.ts` の作成

- [ ] PNG エンコード
  - [ ] 減色後の RGBA 配列 → PNG バッファの変換
  - [ ] sharp を使用したエンコード処理

## 🌐 API エンドポイント

- [ ] `/api/epaper` エンドポイントの作成

  - [ ] `src/app/api/epaper/route.ts` の作成
  - [ ] GET リクエストハンドラーの実装
  - [ ] レスポンスヘッダーの設定（`Content-Type: image/png`）
  - [ ] エラーハンドリングの実装

- [ ] エラーレスポンスの実装
  - [ ] HTTP ステータスコードの適切な設定（200, 400, 500）
  - [ ] エラーレスポンス JSON 形式の実装
  - [ ] エラーコードの定義

## 🎭 コンテンツレンダリング

- [ ] 初期コンテンツの実装
  - [ ] 「Hello World」テキストの表示
  - [ ] 現在時刻の表示
  - [ ] 簡単な図形の描画（矩形、円など）
  - [ ] 7 色テストパターンの作成
  - [ ] `src/components/EpaperContent.tsx` または類似コンポーネントの作成

## 🐛 デバッグ機能

- [ ] デバッグモードの実装
  - [ ] `?debug=true` クエリパラメータの処理
  - [ ] 減色前後の比較画像の生成
  - [ ] パレット変換の可視化機能
  - [ ] ディザリング有無の比較画像
  - [ ] 処理時間の測定と表示

## 🧪 テスト・検証

- [ ] 機能テスト

  - [ ] ローカル環境での動作確認
  - [ ] 生成された画像の確認（色が正しく表示されているか）
  - [ ] エラーハンドリングのテスト
  - [ ] デバッグモードの動作確認

- [ ] パフォーマンステスト
  - [ ] 処理時間の測定
  - [ ] メモリ使用量の確認
  - [ ] Vercel の実行時間制限との比較

## 🚀 デプロイ

- [ ] Vercel へのデプロイ準備

  - [ ] `vercel.json` の設定（必要に応じて）
  - [ ] 環境変数の確認（必要な場合）

- [ ] デプロイと動作確認
  - [ ] Vercel へのデプロイ
  - [ ] デプロイ後の動作確認
  - [ ] エラーログの確認

## 📝 ドキュメント

- [ ] README の更新

  - [ ] セットアップ手順の記載
  - [ ] API エンドポイントの説明
  - [ ] 使用方法の説明

- [ ] コードコメント
  - [ ] 主要な関数・クラスへの JSDoc コメント追加
  - [ ] 複雑な処理への説明コメント追加

## 🔮 将来の拡張（オプション）

- [ ] クエリパラメータ対応

  - [ ] 表示内容の動的変更機能
  - [ ] テキスト、日時、カラー選択などのパラメータ化

- [ ] キャッシュ機能の追加
  - [ ] キャッシュ戦略の設計
  - [ ] 実装とパフォーマンス測定
